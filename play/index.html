<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Math Sprint</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="manifest" href="../manifest.json">
  <link rel="icon" type="image/png" href="../img/gabriel.png">
  <meta name="theme-color" content="#007bff">
  <link rel="apple-touch-icon" href="../img/gabriel.png">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>

<main id="ready-screen" class="screen" role="region" aria-labelledby="ready-heading">
  <h1 id="ready-heading">Math Sprint</h1>
  <div id="audio-loading-spinner" class="audio-loading-spinner" aria-live="polite">
    <span class="spinner"></span>
    <p>Loading audio...</p>
  </div>
  <button id="begin-btn">Loading Audio...</button>
  <div id="audio-loading-banner" class="hidden audio-loading-banner" role="alert" aria-live="polite">
    <p>ğŸµ Audio is still loading in the background, but the game is ready to play!</p>
  </div>
</main>

<main id="main-menu" class="screen hidden" role="region" aria-labelledby="main-menu-heading">
  <h1 id="main-menu-heading">Main Menu</h1>
  <div id="welcome-message" style="text-align: center; margin-bottom: 1.5rem; font-size: 1.1rem; color: #4ecdc4;"></div>
  
  <div id="audio-error-banner" class="hidden audio-error-banner" role="alert" aria-live="polite" aria-labelledby="audio-error-title">
    <div class="audio-error-content">
      <h3 id="audio-error-title">Audio Loading Issue</h3>
      <p>Some audio tracks failed to load. Music and sounds may be unavailable.</p>
      <button id="audio-error-close" class="audio-error-close" aria-label="Dismiss audio error message">Ã—</button>
    </div>
  </div>
  
  <button id="play-now-btn" class="play-now-button" aria-label="Play Now - Start a game">
    Play Now
  </button>
  
  <button id="shop-btn" aria-label="Shop - Buy items with sparks">The Shop âš¡</button>
  <button id="achievements-btn" aria-label="Achievements - View your unlocked achievements">Achievements ğŸ†</button>
  <button id="tutorial-btn" aria-label="Tutorial - Learn how to play">Tutorial ğŸ“š</button>
  <button id="settings-btn" aria-label="Settings - Adjust audio, gameplay, and accessibility options">Settings</button>
</main>

<dialog id="mode-selection-screen" class="mode-selection-modal" role="dialog" aria-modal="true" aria-labelledby="mode-selection-heading">
  <div class="mode-selection-content">
    <button id="mode-selection-close" class="mode-selection-close" aria-label="Close mode selection">Ã—</button>
    <h2 id="mode-selection-heading">Choose Your Mode</h2>
    
    <button id="sprint-mode-btn" class="mode-button" aria-label="Sprint Mode - 60 seconds">
      Sprint Mode
      <span class="mode-subtitle">(60 Seconds)</span>
    </button>
    
    <button id="endless-mode-btn" class="mode-button" aria-label="Endless Mode - 3 strikes">
      Endless Mode
      <span class="mode-subtitle">(3 Strikes)</span>
    </button>

    <button id="survival-mode-btn" class="mode-button danger" aria-label="Survival Mode - Danger zone">
      Survival Mode
      <span class="mode-subtitle">(Danger!)</span>
    </button>

    <button id="daily-challenge-btn" class="mode-button" aria-label="Daily Challenge - New challenge every day">
      Daily Challenge
      <span class="mode-subtitle">(New Daily)</span>
    </button>
  </div>
</dialog>
  <button id="tutorial-btn" aria-label="Tutorial - Learn how to play">Tutorial ğŸ“š</button>
  <button id="settings-btn" aria-label="Settings - Adjust audio, gameplay, and accessibility options">Settings</button>
</main>

<main id="shop-screen" class="screen hidden" role="region" aria-labelledby="shop-heading">
    <h1 id="shop-heading">The Shop</h1>
    
  <div class="currency-display">
    âš¡ <span id="wallet-balance">0</span> Sparks
  </div>
  <div id="shop-live" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <div id="shop-tabs" class="shop-tabs" role="tablist" aria-label="Item categories"></div>
    
  <div class="shop-grid" id="shop-grid" aria-label="Shop items"></div>
    
    <button id="back-to-menu-shop-btn">Back to Menu</button>
</main>

<main id="game-screen" class="screen hidden" role="region" aria-labelledby="game-heading">
  
  <div id="countdown-overlay" class="hidden" role="alert" aria-live="assertive">
    <span id="countdown-text">3</span>
  </div>

  <form id="game-form" class="game-container">
    <h1 id="game-heading" class="sr-only">Game</h1>
    
    <div id="gabriel-container" aria-hidden="true">
        <div id="gabriel-sprite"></div>
    </div>

    <div id="problem" aria-live="polite"></div>
    <label for="answer" id="answer-label" class="sr-only">Your answer:</label>
    <input type="tel" id="answer" inputmode="numeric" aria-labelledby="answer-label" required />
    <button id="submit">Submit</button>
    <div id="quick-use-bar" class="quick-use-bar" aria-label="Quick use items"></div>
    
    <div id="feedback" role="alert" style="min-height: 1.5em;"></div>
    <div id="item-live" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
    
    <div class="stats-row">
        <div id="score">Score: 0</div>
        <div id="timer">Time: 60s</div>
        <div id="lives" class="hidden">Lives: 3</div>
        <div id="consecutive-mistakes" class="hidden">âš ï¸ Consecutive: 0/3</div>
    </div>
  </form>
</main>

<main id="cash-out-popup" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="cash-out-heading">
    <h1 id="cash-out-heading">SESSION COMPLETE</h1>
    <div id="cash-out-sparks" style="font-size: 2rem; margin: 1rem 0; color: #ffab00; font-weight: bold;">
        +0 SPARKS
    </div>
    <button id="cash-out-close">Bank It!</button>
</main>

<main id="game-over-screen" class="screen hidden" role="region" aria-labelledby="game-over-heading">
  <h1 id="game-over-heading">Game Over</h1>
  <p id="game-over-player-name" style="text-align: center; color: #4ecdc4; margin-bottom: 1rem;"></p>
  <p>Your Final Score:</p>
  <h2 id="final-score">0</h2>
  <div id="score-breakdown">
    <p>Problems: <span id="problems-answered">0</span></p>
    <p>Correct: <span id="correct-answers">0</span></p>
    <p>Accuracy: <span id="accuracy">0%</span></p>
  </div>
  <button id="view-achievements-game-over-btn" class="hidden" style="background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; font-weight: bold;">ğŸ† View Achievements</button>
  <button id="play-again-btn">Play Again</button>
  <button id="main-menu-game-over-btn">Main Menu</button>
</main>

<main id="high-score-screen" class="screen hidden" role="region" aria-labelledby="high-score-heading">
  <h1 id="high-score-heading">New High Score!</h1>
  <p id="high-score-player-name" style="text-align: center; color: #4ecdc4; margin-bottom: 1rem;"></p>
  <h2 id="new-high-score">0</h2>
  <button id="view-achievements-high-score-btn" class="hidden" style="background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; font-weight: bold;">ğŸ† View Achievements</button>
  <button id="play-again-high-score-btn">Play Again</button>
  <button id="main-menu-high-score-btn">Main Menu</button>
  <button id="score-breakdown-btn">See Breakdown</button>
</main>

<main id="settings-screen" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="settings-heading">
  
  <button id="back-to-menu-btn" class="back-button" aria-label="Back to Main Menu">&larr; Back</button>
  
  <h1 id="settings-heading">Settings</h1>

  <div class="tab-list" role="tablist">
    <button id="tab-audio" role="tab" aria-selected="true" aria-controls="tabpanel-audio">Audio</button>
    <button id="tab-gameplay" role="tab" aria-selected="false" aria-controls="tabpanel-gameplay">Gameplay</button>
    <button id="tab-accessibility" role="tab" aria-selected="false" aria-controls="tabpanel-accessibility">Accessibility</button>
  </div>

  <div id="tabpanel-audio" role="tabpanel" aria-labelledby="tab-audio">
    <h2>Audio Settings</h2>
    <div class="setting-group">
      <label for="master-volume">Master Volume</label>
      <input type="range" id="master-volume" min="0" max="100" value="100">
    </div>
    <div class="setting-group">
      <label for="music-volume">Music Volume</label>
      <input type="range" id="music-volume" min="0" max="100" value="100">
    </div>
    <div class="setting-group">
      <label for="sfx-volume">SFX Volume</label>
      <input type="range" id="sfx-volume" min="0" max="100" value="100">
    </div>
  </div>

  <div id="tabpanel-gameplay" role="tabpanel" aria-labelledby="tab-gameplay" class="hidden">
    <h2>Gameplay Settings</h2>
    <fieldset class="setting-group">
      <legend>Math Operations</legend>
      <input type="checkbox" id="op-addition" checked> <label for="op-addition">Addition (+)</label><br>
      <input type="checkbox" id="op-subtraction"> <label for="op-subtraction">Subtraction (-)</label><br>
      <input type="checkbox" id="op-multiplication"> <label for="op-multiplication">Multiplication (Ã—)</label><br>
      <input type="checkbox" id="op-division"> <label for="op-division">Division (Ã·)</label>
    </fieldset>
    <div class="setting-group">
      <input type="checkbox" id="disable-countdown">
      <label for="disable-countdown">Disable Start Countdown</label>
    </div>
  </div>

  <div id="tabpanel-accessibility" role="tabpanel" aria-labelledby="tab-accessibility" class="hidden">
    <h2>Accessibility</h2>
    <div class="setting-group">
      <button id="contrast-toggle-settings">Toggle High Contrast</button>
    </div>
    <div class="setting-group">
      <input type="checkbox" id="enable-feedback-prompts" checked>
      <label for="enable-feedback-prompts">Enable feedback prompts</label>
    </div>
  </div>
</main>

<main id="whats-new-popup" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="whats-new-heading">
  <div class="popup-content">
    <h1 id="whats-new-heading">Update</h1>
    <p>Loading update notes...</p>
    <ul></ul>
    <button id="close-popup-btn">Let's Play!</button>
  </div>
</main>

<main id="audio-feature-popup" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="audio-feature-heading">
  <div class="popup-content">
    <h1 id="audio-feature-heading">ğŸµ Faster Startup</h1>
    <p>Audio files are loading in the background while you play! This means you can start playing immediately, even on slower connections.</p>
    <p><strong>Pro tip:</strong> Sounds will work perfectly once loaded.</p>
    <button id="audio-feature-close-btn">Got It!</button>
  </div>
</main>

<main id="tutorial-screen" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="tutorial-heading">
  <div class="popup-content" style="max-width: 600px; margin: 0 auto;">
    <h1 id="tutorial-heading">MathSprint Tutorial</h1>
    <div id="tutorial-phase-content" style="min-height: 200px;" aria-live="polite" aria-atomic="true">
      <!-- Phase content will be inserted here -->
    </div>
    <div id="tutorial-progress" style="text-align: center; color: #999; margin: 1rem 0; font-size: 0.9rem;" aria-live="polite"></div>
    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
      <button id="tutorial-prev-btn" class="hidden" aria-label="Previous tutorial step">â† Back</button>
      <button id="tutorial-next-btn" aria-label="Next tutorial step">Next â†’</button>
      <button id="tutorial-skip-btn" aria-label="Skip tutorial">Skip Tutorial</button>
    </div>
  </div>
</main>

<main id="feedback-popup" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="feedback-popup-heading">
  <div class="popup-content">
    <h2 id="feedback-popup-heading">Enjoying Math Sprint?</h2>
    <p>This is a work in progress, and your feedback helps us make it better!</p>
    <div class="popup-buttons">
      <button id="feedback-share-btn" class="popup-button primary">Share Feedback</button>
      <button id="feedback-later-btn" class="popup-button">Maybe Later</button>
      <button id="feedback-dont-ask-btn" class="popup-button">Don't Ask Again</button>
    </div>
  </div>
</main>

<main id="achievements-screen" class="screen hidden" role="region" aria-labelledby="achievements-heading">
  <h1 id="achievements-heading">Achievements</h1>
  <p id="achievements-stats">Unlocked: <span id="achievements-unlocked-count">0</span> / <span id="achievements-total-count">0</span></p>
  <div id="achievements-container" class="achievements-grid"></div>
  <button id="back-to-menu-achievements-btn">Back to Menu</button>
</main>

<!-- Achievement live region for screen reader announcements -->
<div id="achievement-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<!-- Onboarding Step 1: Welcome + Name Entry -->
<div id="onboarding-step1" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="onboarding-step1-heading">
  <div class="popup-content onboarding-content">
    <h2 id="onboarding-step1-heading">Welcome to MathSprint! ğŸ®</h2>
    <p style="margin-bottom: 2rem;">Get ready to challenge your math skills with fast-paced problems, strategic items, and multiple game modes.</p>
    
    <form id="onboarding-name-form">
      <div style="margin-bottom: 1.5rem;">
        <label for="onboarding-name-input" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
          Your Name
        </label>
        <input 
          id="onboarding-name-input" 
          type="text" 
          placeholder="Enter your name" 
          required
          aria-describedby="onboarding-name-help"
          style="width: 100%; padding: 0.75rem; border: 2px solid #4ecdc4; border-radius: 8px; font-size: 1rem; background: #222; color: #fff;"
        />
        <small id="onboarding-name-help" style="display: block; margin-top: 0.5rem; color: #999;">
          Your name is required for future leaderboards!
        </small>
        <div id="onboarding-name-error" class="hidden" style="color: #ff6b6b; margin-top: 0.5rem;" role="alert"></div>
      </div>
      
      <div class="popup-buttons">
        <button type="submit" class="popup-button primary" id="onboarding-step1-next">Continue â†’</button>
      </div>
    </form>
  </div>
</div>

<!-- Onboarding Step 2: Settings Preview -->
<div id="onboarding-step2" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="onboarding-step2-heading">
  <div class="popup-content onboarding-content">
    <h2 id="onboarding-step2-heading">Customize Your Experience âš™ï¸</h2>
    <p style="margin-bottom: 1.5rem;">Choose which operations you'd like to practice:</p>
    
    <form id="onboarding-settings-form" style="margin-bottom: 2rem;">
      <fieldset style="border: none; padding: 0;">
        <legend style="display: none;">Math Operations</legend>
        
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <label style="display: flex; align-items: center; cursor: pointer; gap: 0.75rem;">
            <input 
              id="onboarding-op-addition" 
              type="checkbox" 
              checked
              aria-label="Enable Addition"
              style="width: 20px; height: 20px; cursor: pointer;"
            />
            <span>â• Addition</span>
          </label>
          
          <label style="display: flex; align-items: center; cursor: pointer; gap: 0.75rem;">
            <input 
              id="onboarding-op-subtraction" 
              type="checkbox"
              aria-label="Enable Subtraction"
              style="width: 20px; height: 20px; cursor: pointer;"
            />
            <span>â– Subtraction</span>
          </label>
          
          <label style="display: flex; align-items: center; cursor: pointer; gap: 0.75rem;">
            <input 
              id="onboarding-op-multiplication" 
              type="checkbox"
              aria-label="Enable Multiplication"
              style="width: 20px; height: 20px; cursor: pointer;"
            />
            <span>âœ–ï¸ Multiplication</span>
          </label>
          
          <label style="display: flex; align-items: center; cursor: pointer; gap: 0.75rem;">
            <input 
              id="onboarding-op-division" 
              type="checkbox"
              aria-label="Enable Division"
              style="width: 20px; height: 20px; cursor: pointer;"
            />
            <span>â— Division</span>
          </label>
        </div>
      </fieldset>
    </form>
    
    <div class="popup-buttons">
      <button type="button" class="popup-button" id="onboarding-step2-back">â† Back</button>
      <button type="button" class="popup-button primary" id="onboarding-step2-next">Continue â†’</button>
    </div>
  </div>
</div>

<!-- Onboarding Step 3: Tutorial Offer & Completion -->
<div id="onboarding-step3" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="onboarding-step3-heading">
  <div class="popup-content onboarding-content">
    <h2 id="onboarding-step3-heading">You're All Set! ğŸ‰</h2>
    <p style="margin-bottom: 1.5rem;">Ready to jump in? We have two options for you:</p>
    
    <div style="background: rgba(78, 205, 196, 0.1); border: 2px solid #4ecdc4; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
      <h3 style="margin-top: 0; color: #4ecdc4; margin-bottom: 0.75rem;">ğŸ“š Take the Interactive Tutorial</h3>
      <p style="margin: 0 0 0.75rem 0; color: #ccc;">Learn all the game mechanics step-by-step with guided walkthroughs.</p>
      <ul style="margin: 0.75rem 0; padding-left: 1.5rem; color: #aaa;">
        <li>Master all 4 game modes</li>
        <li>Learn the shop and items</li>
        <li>Unlock achievement rewards</li>
        <li><strong>Get a free Time Freeze item!</strong></li>
      </ul>
    </div>
    
    <div class="popup-buttons">
      <button type="button" class="popup-button" id="onboarding-skip-tutorial">Skip â†’ Go to Menu</button>
      <button type="button" class="popup-button primary" id="onboarding-start-tutorial">ğŸ“ Start Tutorial</button>
    </div>
  </div>
</div>

<!-- Bonus Modal -->
<div id="bonus-modal" class="screen hidden" role="dialog" aria-modal="true" aria-labelledby="bonus-modal-heading">
  <div class="popup-content">
    <h2 id="bonus-modal-heading">Thanks for updating!</h2>
    <p>We reset saves for v0.9.2 and added <strong>+500 Sparks</strong> to your wallet.</p>
    <div class="popup-buttons">
      <button id="bonus-modal-close" class="popup-button primary">Nice!</button>
    </div>
  </div>
</div>

<!-- Message of the Day Dialog -->
<dialog id="motd-dialog" class="motd-dialog" aria-labelledby="motd-title" aria-describedby="motd-message" aria-modal="true" role="alertdialog">
  <div class="motd-content">
    <button id="motd-close-btn" class="motd-close" aria-label="Close announcement">Ã—</button>
    <div class="motd-icon" aria-hidden="true">â„¹ï¸</div>
    <h2 id="motd-title" class="motd-title">Announcement</h2>
    <div id="motd-message" class="motd-message"></div>
    <button id="motd-dismiss-btn" class="motd-dismiss-btn">Got it!</button>
  </div>
</dialog>

<footer>
  <p>&copy; <span id="copyright-year">2026</span> James Trimble. All rights reserved.</p>
  <p>Music generated by <a href="https://producer.ai/" target="_blank">Producer.ai</a></p>
  <div class="footer-links" style="margin-top: 1rem; font-size: 0.9rem;">
    <a href="../privacy/" style="color: #666; margin: 0 10px; text-decoration: none; border-bottom: 1px dotted #999;">Privacy</a>
    <a href="../credits/" style="color: #666; margin: 0 10px; text-decoration: none; border-bottom: 1px dotted #999;">Credits</a>
    <a href="../feedback/" style="color: #666; margin: 0 10px; text-decoration: none; border-bottom: 1px dotted #999;">Feedback</a>
  </div>
  <p id="version-number">v0.0.0</p>
</footer>

<!-- Load main entry point (all modules are imported from here) -->
<script src="../js/main.js" type="module"></script>

</body>
</html>
